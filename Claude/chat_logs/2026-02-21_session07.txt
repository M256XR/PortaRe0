PortaRe0 チャットログ要約
セッション: 07（2026-02-21）
Claude Project: PortaRe0

================================================================
セッション 07 - VL812 usb_hubシート完成・各種設計確認
================================================================
日時: 2026-02-21

主な内容:
- power シートのレビュー・修正方針確定
- キーレイアウト確定・GPIO割り当て確定
- VL812 usb_hub シート完成

================================================================
power シートの修正事項
================================================================

確定した修正:
- SCL/SDA → Global Label（I2C_SCL / I2C_SDA）
- USB_D+/D- → Global Label（USB_DP / USB_DM）
- 5V_SYS → Global Label からカスタムパワーシンボルに変更
- +3V3 → KiCad標準パワーシンボル（AP2112K VOUT）
- BQ25895プルアップ → +3V3 でOK
- BQ_INT → 既にGlobal Label済み
- VBAT → +BATT パワーシンボル

キルスイッチ配置確定:
  +BATT → BQ25895 → VSYS → SW_SPDT（キルスイッチ）→ TPS61023 VIN / AP2112K VIN
  ※キルスイッチOFF時もBQ25895は動作（充電継続可能）
  ※AP2112K→+3V3→RP2040もキルスイッチOFFで停止（これで正しい）

パワーシンボル構成確定:
  +BATT / VSYS / 5V_SYS → カスタムパワーシンボル（PortaRe0_lib）
  +3V3 → KiCad標準
  +3V3_HUB / +1V2_HUB → カスタムパワーシンボル（VL812用内部電源）

GND/GNDPWRの使い分け:
  一箇所明示的に接続点を作ればERCエラー回避可能

================================================================
キーボード設計確定
================================================================

キーレイアウト（KLE形式）:
  ["Left",{x:13},"Right"],
  ["esc","1","2","3","4","5","6","7","8","9","0","-","^","\\","BS"],
  [{w:1.5},"h/z","Q","W","E","R","T","Y","U","I","O","P","@","[",{x:0.25,a:7,w:1.25,h:2,w2:1.5,h2:1,x2:-0.25},""],
  [{a:4,w:1.75},"Tab","A","S","D","F","G","H","J","K","L",";",":","]"],
  [{w:2},"Shift","Z","X","C","V","B","N","M",",",".","/","\\",{w:2},"RShift"],
  [{x:4.5,w:4.5},"Space",{x:0.5},"Back","Next",{x:0.5},"Ctrl","Fn","Alt"]

合計66キー / 9×8マトリクス（COL9本 + ROW8本 = 17本）
keyboard/keyboard-layout.json に保存済み

RP2040 GPIO割り当て確定:
  GP0〜GP8:  キーマトリクス COL（9本）
  GP9〜GP16: キーマトリクス ROW（8本）
  GP17: I2C_SCL（BQ25895）
  GP18: I2C_SDA（BQ25895）
  GP19: BQ_INT
  GP20: RP2040_EN（TPS61023 EN制御）
  GP21: I2S BCLK
  GP22: I2S LRCLK
  GP23: I2S SDIN
  GP24〜GP26: LED × 3
  GP27（ADC1）: アナログスティック X
  GP28（ADC2）: アナログスティック Y
  GP29: 予備
  合計29本/30本

================================================================
VL812 usb_hub シート 確定内容
================================================================

電源構成:
  VCC5I (19, 38) → 5V_SYS
  DC33FB (18) → +3V3_HUB + 100nF + 4.7µF → GNDPWR
  DC12FB (37) → +1V2_HUB + 10µF + 100nF → GNDPWR
  LX (39) → L(4.7µH) → +1V2_HUB
  Pin40 → NC（フロート、データシート確認済み）
  VCC12I (20) → GNDPWR（内部1.0V LDO無効化）
  DC10FB (21) → NC

デカップリング:
  VDD (30, 48, 58): 各10µF + 100nF → GNDPWR
  VSUS33 (36, 41, 49): 各100nF → GNDPWR
  VCCA33系 (2, 8, 27, 71): 各100nF + 10pF → GNDPWR
  VCCA12系 (5, 13, 24, 61, 68, 74): 各100nF + 10pF → GNDPWR

USB配線ルール（重要）:
  USB3.0 TX側のみACカップリング100nF直列挿入
  USB3.0 RX側・USB2.0全ライン → ACカップリングなし直結
  DP3（RP2040）SS系（Pin3,4,6,7）→ NC

SPI Flash（W25Q32）:
  SPICS# (32): W25Q32 /CS + 100kΩ→GNDPWR（プルアップなし）
  SPISCLK (33): W25Q32 CLK + 100kΩ→GNDPWR
  SPISI (34): W25Q32 DI + 100kΩ→GNDPWR
  SPISO (35): W25Q32 DO + 100kΩ→GNDPWR
  W25Q32 /HOLD, /WP → 10kΩ→+3V3_HUB
  W25Q32 VCC → +3V3_HUB + 100nF→GNDPWR

LED/SPI共有ピン:
  USBHGRN1〜4 (50〜53): 各100kΩ→GNDPWR（必須）
  USBHMBR1〜4 (32〜35): 上記SPI Flash兼用、100kΩプルダウン済み

ストラップ・その他:
  SSREXT (1): 200Ω(1%)→GNDPWR
  RESET# (54): 10kΩ→+3V3_HUB + 100nF→GNDPWR
  VBUSDET (31): 5V_SYS
  EXTPWRON (47): 5V_SYS直結
  USBHOC1# (45): 10kΩ→+3V3_HUB（過電流誤検知防止）
  USBHOC2# (44): 10kΩ→+3V3_HUB（同上）
  USBHPE1# (43): NC
  USBHPE2B# (42): NC
  COREPWRDN# (46): NC
  TESTEN (57): NC
  SSXI (75) / SSXO (76): 25MHz水晶 + 15pF×2→GNDPWR
  PAD: GNDPWR

================================================================
次のアクション
================================================================
1. KiCad: RP2040 keyboard シート
2. KiCad: MAX98357A × 2 audio シート
3. KiCad: connectors シート（新規作成）
